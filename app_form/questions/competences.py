COMPETENCES_QUESTIONS = {
    "title": "Compétences Visées",
    "description": "Formulation des compétences visées pour le scénario CMO",
    "competences": [
        {
            "id": "competence_1",
            "title": "Compétence 1",
            "steps": [
                {
                    "step": 1,
                    "title": "Vos idées clés",
                    "description": "Indiquez ici les éléments ou mots-clés importants pour cette compétence (contenu, contexte, résultat attendu)",
                    "field_name": "idees_cles_1",
                    "type": "textarea",
                    "placeholder": "Ex: inclusion scolaire, outils numériques, collaboration..."
                },
                {
                    "step": 2,
                    "title": "Niveau visé",
                    "description": "Choisir le niveau visé dans le domaine cognitif",
                    "field_name": "niveau_1",
                    "type": "radio",
                    "options": [
                        "Haut : Créer / Évaluer / Analyser",
                        "Moyen : Appliquer / Comprendre", 
                        "Bas : Se rappeler"
                    ]
                },
                {
                    "step": 3,
                    "title": "Verbes d'action",
                    "description": "Verbe(s) d'action cognitifs",
                    "field_name": "verbes_1",
                    "type": "text",
                    "placeholder": "Ex: créer, analyser, appliquer..."
                },
                {
                    "step": 4,
                    "title": "Formulation finale",
                    "description": "Proposition générée automatiquement. Modifiez-la directement si nécessaire.",
                    "field_name": "formulation_1",
                    "type": "textarea",
                    "placeholder": "Formulation de la compétence..."
                }
            ]
        },
        {
            "id": "competence_2", 
            "title": "Compétence 2",
            "steps": [
                {
                    "step": 1,
                    "title": "Vos idées clés",
                    "description": "Indiquez ici les éléments ou mots-clés importants pour cette compétence (contenu, contexte, résultat attendu)",
                    "field_name": "idees_cles_2",
                    "type": "textarea",
                    "placeholder": "Ex: inclusion scolaire, outils numériques, collaboration..."
                },
                {
                    "step": 2,
                    "title": "Niveau visé",
                    "description": "Choisir le niveau visé dans le domaine cognitif",
                    "field_name": "niveau_2",
                    "type": "radio",
                    "options": [
                        "Haut : Créer / Évaluer / Analyser",
                        "Moyen : Appliquer / Comprendre",
                        "Bas : Se rappeler"
                    ]
                },
                {
                    "step": 3,
                    "title": "Verbes d'action",
                    "description": "Verbe(s) d'action cognitifs",
                    "field_name": "verbes_2",
                    "type": "text",
                    "placeholder": "Ex: créer, analyser, appliquer..."
                },
                {
                    "step": 4,
                    "title": "Formulation finale",
                    "description": "Proposition générée automatiquement. Modifiez-la directement si nécessaire.",
                    "field_name": "formulation_2",
                    "type": "textarea",
                    "placeholder": "Formulation de la compétence..."
                }
            ]
        },
        {
            "id": "competence_3",
            "title": "Compétence 3", 
            "steps": [
                {
                    "step": 1,
                    "title": "Vos idées clés",
                    "description": "Indiquez ici les éléments ou mots-clés importants pour cette compétence (contenu, contexte, résultat attendu)",
                    "field_name": "idees_cles_3",
                    "type": "textarea",
                    "placeholder": "Ex: inclusion scolaire, outils numériques, collaboration..."
                },
                {
                    "step": 2,
                    "title": "Niveau visé",
                    "description": "Choisir le niveau visé dans le domaine cognitif",
                    "field_name": "niveau_3",
                    "type": "radio",
                    "options": [
                        "Haut : Créer / Évaluer / Analyser",
                        "Moyen : Appliquer / Comprendre",
                        "Bas : Se rappeler"
                    ]
                },
                {
                    "step": 3,
                    "title": "Verbes d'action",
                    "description": "Verbe(s) d'action cognitifs",
                    "field_name": "verbes_3",
                    "type": "text",
                    "placeholder": "Ex: créer, analyser, appliquer..."
                },
                {
                    "step": 4,
                    "title": "Formulation finale",
                    "description": "Proposition générée automatiquement. Modifiez-la directement si nécessaire.",
                    "field_name": "formulation_3",
                    "type": "textarea",
                    "placeholder": "Formulation de la compétence..."
                }
            ]
        },
        {
            "id": "competence_4",
            "title": "Compétence 4",
            "steps": [
                {
                    "step": 1,
                    "title": "Vos idées clés",
                    "description": "Indiquez ici les éléments ou mots-clés importants pour cette compétence (contenu, contexte, résultat attendu)",
                    "field_name": "idees_cles_4",
                    "type": "textarea",
                    "placeholder": "Ex: inclusion scolaire, outils numériques, collaboration..."
                },
                {
                    "step": 2,
                    "title": "Niveau visé",
                    "description": "Choisir le niveau visé dans le domaine cognitif",
                    "field_name": "niveau_4",
                    "type": "radio",
                    "options": [
                        "Haut : Créer / Évaluer / Analyser",
                        "Moyen : Appliquer / Comprendre",
                        "Bas : Se rappeler"
                    ]
                },
                {
                    "step": 3,
                    "title": "Verbes d'action",
                    "description": "Verbe(s) d'action cognitifs",
                    "field_name": "verbes_4",
                    "type": "text",
                    "placeholder": "Ex: créer, analyser, appliquer..."
                },
                {
                    "step": 4,
                    "title": "Formulation finale",
                    "description": "Proposition générée automatiquement. Modifiez-la directement si nécessaire.",
                    "field_name": "formulation_4",
                    "type": "textarea",
                    "placeholder": "Formulation de la compétence..."
                }
            ]
        }
    ],
    "verb_suggestions": {
        "haut": ["créer", "concevoir", "structurer", "synthétiser", "planifier", "juger", "justifier", "analyser", "comparer", "différencier"],
        "moyen": ["appliquer", "utiliser", "démontrer", "résoudre", "expliquer", "illustrer", "interpréter", "reformuler"],
        "bas": ["définir", "nommer", "décrire", "identifier", "rappeler", "lister", "reconnaître"]
    },
    "bloom_taxonomy": {
        "creer": {
            "name": "Créer",
            "description": "Produire du nouveau contenu ou des idées originales",
            "verbs": ["créer", "concevoir", "composer", "construire", "développer", "élaborer", "formuler", "générer", "inventer", "planifier", "produire", "structurer", "synthétiser", "assembler", "organiser", "proposer", "imaginer"]
        },
        "evaluer": {
            "name": "Évaluer",
            "description": "Porter un jugement basé sur des critères et des standards",
            "verbs": ["apprécier", "argumenter", "assurer", "attester", "choisir", "conclure", "critiquer", "défendre", "déterminer", "évaluer", "juger", "justifier", "mesurer", "préférer", "prioriser", "recommander", "sélectionner", "valider", "vérifier", "contrôler", "estimer"]
        },
        "analyser": {
            "name": "Analyser",
            "description": "Décomposer un concept en ses éléments constitutifs",
            "verbs": ["analyser", "catégoriser", "classifier", "comparer", "contraster", "décomposer", "différencier", "discriminer", "distinguer", "examiner", "identifier", "inférer", "organiser", "relier", "structurer", "déduire", "déterminer", "examiner", "explorer", "investiguer"]
        },
        "appliquer": {
            "name": "Appliquer",
            "description": "Utiliser des informations dans des situations nouvelles",
            "verbs": ["appliquer", "calculer", "démontrer", "employer", "exécuter", "illustrer", "implémenter", "manipuler", "modifier", "opérer", "pratiquer", "résoudre", "utiliser", "adapter", "expérimenter", "mettre_en_œuvre", "réaliser", "transférer"]
        },
        "comprendre": {
            "name": "Comprendre",
            "description": "Construire du sens à partir de différents types de messages",
            "verbs": ["classifier", "décrire", "discuter", "expliquer", "exprimer", "identifier", "indiquer", "interpréter", "localiser", "paraphraser", "reconnaître", "reformuler", "reporter", "résumer", "traduire", "comprendre", "associer", "comparer", "convertir", "exemplifier", "extrapoler", "généraliser", "inférer", "prédire"]
        },
        "se_rappeler": {
            "name": "Se rappeler",
            "description": "Retrouver des informations pertinentes en mémoire",
            "verbs": ["citer", "définir", "décrire", "énumérer", "identifier", "lister", "nommer", "rappeler", "reconnaître", "reproduire", "retrouver", "spécifier", "énoncer", "mémoriser", "réciter", "reproduire", "sélectionner", "énumérer", "étiqueter", "localiser", "reconnaître", "reproduire", "retrouver", "spécifier"]
        },
        "caracteriser": {
            "name": "Caractériser",
            "description": "Intégrer des valeurs dans un système cohérent",
            "verbs": ["adopter", "agir", "caractériser", "défendre", "démontrer", "incarner", "intégrer", "modifier", "pratiquer", "préférer", "proposer", "questionner", "reviser", "servir", "soutenir", "valoriser", "vivre", "s'engager", "s'identifier", "se_consacrer"]
        },
        "organiser": {
            "name": "Organiser",
            "description": "Organiser des valeurs en un système cohérent",
            "verbs": ["adapter", "ajuster", "arranger", "catégoriser", "classifier", "combiner", "comparer", "compléter", "défendre", "établir", "formuler", "généraliser", "identifier", "intégrer", "modifier", "ordonner", "organiser", "préparer", "relier", "systématiser", "synthetiser", "valoriser"]
        },
        "valoriser": {
            "name": "Valoriser",
            "description": "Attribuer une valeur à quelque chose",
            "verbs": ["accepter", "adopter", "apprécier", "chercher", "choisir", "défendre", "désirer", "estimer", "favoriser", "préférer", "rechercher", "sélectionner", "valoriser", "vouloir", "s'engager", "s'intéresser", "s'impliquer", "s'investir", "s'enthousiasmer", "s'émerveiller"]
        },
        "repondre": {
            "name": "Répondre",
            "description": "Réagir activement à quelque chose",
            "verbs": ["accepter", "acquiescer", "agir", "aider", "applaudir", "approuver", "discuter", "donner", "greeter", "pratiquer", "présenter", "lire", "rapporter", "select", "participer", "répondre", "satisfaire", "visiter", "volunteer", "s'impliquer", "s'engager", "s'intéresser", "s'enthousiasmer", "s'émerveiller"]
        },
        "recevoir": {
            "name": "Recevoir",
            "description": "Être conscient et prêt à recevoir",
            "verbs": ["accepter", "acquiescer", "écouter", "attendre", "être_conscient", "être_ouvert", "être_prêt", "être_sensible", "être_attentif", "être_disponible", "être_réceptif", "être_curieux", "être_intéressé", "être_concerné", "être_impliqué", "être_engagé", "être_motivé", "être_enthousiaste", "être_émerveillé", "être_étonné"]
        }
    }
}

def generate_competence_template(competence_number):
    """Generate a competence template for a given number"""
    return {
        "id": f"competence_{competence_number}",
        "title": f"Compétence {competence_number}",
        "competence_number": competence_number,  # Add explicit number tracking
        "steps": [
            {
                "step": 1,
                "title": "Vos idées clés",
                "description": "Indiquez ici les éléments ou mots-clés importants pour cette compétence (contenu, contexte, résultat attendu)",
                "field_name": f"idees_cles_{competence_number}",
                "type": "textarea",
                "placeholder": "Ex: inclusion scolaire, outils numériques, collaboration..."
            },
            {
                "step": 2,
                "title": "Niveau visé",
                "description": "Choisir le niveau visé dans le domaine cognitif",
                "field_name": f"niveau_{competence_number}",
                "type": "radio",
                "options": [
                    "Haut : Créer / Évaluer / Analyser",
                    "Moyen : Appliquer / Comprendre",
                    "Bas : Se rappeler"
                ]
            },
            {
                "step": 3,
                "title": "Verbes d'action",
                "description": "Verbe(s) d'action cognitifs",
                "field_name": f"verbes_{competence_number}",
                "type": "text",
                "placeholder": "Ex: créer, analyser, appliquer..."
            },
            {
                "step": 4,
                "title": "Formulation finale",
                "description": "Proposition générée automatiquement. Modifiez-la directement si nécessaire.",
                "field_name": f"formulation_{competence_number}",
                "type": "textarea",
                "placeholder": "Formulation de la compétence..."
            }
        ]
    }

def get_competences_with_count(count):
    """Get competences list with specified count"""
    competences = []
    for i in range(1, count + 1):
        competences.append(generate_competence_template(i))
    return competences

def get_next_competence_number(existing_competences):
    """Get the next available competence number based on existing competences"""
    if not existing_competences:
        return 1
    
    # Find the highest competence number
    max_number = 0
    for competence in existing_competences:
        if 'competence_number' in competence:
            max_number = max(max_number, competence['competence_number'])
        else:
            # Fallback: extract number from ID
            try:
                number = int(competence['id'].split('_')[1])
                max_number = max(max_number, number)
            except (IndexError, ValueError):
                continue
    
    return max_number + 1

def reorder_competences(competences):
    """Reorder competences to have sequential numbering"""
    reordered = []
    for i, competence in enumerate(competences, 1):
        new_competence = competence.copy()
        new_competence['id'] = f"competence_{i}"
        new_competence['title'] = f"Compétence {i}"
        new_competence['competence_number'] = i
        
        # Update field names in steps
        for step in new_competence['steps']:
            if 'field_name' in step:
                step['field_name'] = step['field_name'].replace(
                    f"_{competence.get('competence_number', i)}", f"_{i}"
                )
        
        reordered.append(new_competence)
    
    return reordered 