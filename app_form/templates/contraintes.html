<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire - Contraintes Formation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navigation.css') }}">
    <style>
        /* Page-specific styles for contraintes.html */
        .header {
            background: var(--gradient-danger);
        }

        .step-indicator .step.active {
            color: var(--primary-red);
        }

        .question:hover {
            border-color: var(--primary-red);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.1);
        }

        .question-number {
            background: var(--primary-red);
        }

        input[type="text"]:focus, textarea:focus {
            border-color: var(--primary-red);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .radio-item:hover {
            border-color: var(--primary-red);
            background: #fff5f5;
        }

        .text-input-container {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--light-gray);
            border-radius: var(--radius-small);
            border-left: 4px solid var(--primary-red);
        }

        .submit-btn {
            background: var(--gradient-danger);
            box-shadow: var(--shadow-danger);
        }

        .submit-btn:hover {
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .progress-fill {
            background: var(--gradient-danger);
        }

        .migration-warning {
            background: linear-gradient(135deg, #ff9ff3 0%, #f368e0 100%);
            color: var(--white);
            padding: var(--spacing-lg);
            border-radius: var(--radius-small);
            margin: var(--spacing-lg) 0;
            border-left: 5px solid #e056fd;
        }

        .migration-warning h3 {
            margin-bottom: var(--spacing-md);
            font-size: var(--font-size-xl);
        }

        .migration-warning a {
            color: var(--white);
            text-decoration: underline;
            font-weight: bold;
        }

        .migration-warning .important {
            background: rgba(255,255,255,0.2);
            padding: var(--spacing-sm);
            border-radius: 5px;
            margin: var(--spacing-sm) 0;
        }

        .yaml-output {
            background: var(--light-gray);
            padding: var(--spacing-lg);
            border-radius: var(--radius-small);
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            font-size: var(--font-size-small);
            border: 1px solid var(--border-gray);
            margin-top: var(--spacing-lg);
        }

        /* Navigation buttons alignment for first page */
        .navigation-buttons {
            text-align: right !important;
            margin-top: 20px;
        }

        .navigation-buttons .btn-next {
            background: linear-gradient(135deg, #20bf6b 0%, #0fb9b1 100%) !important;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 0;
        }

        .navigation-buttons .btn-next:hover {
            box-shadow: 0 5px 15px rgba(32, 191, 107, 0.3);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        {% include 'includes/header.html' %}

        <div class="form-container">

            <form id="questionnaireForm" method="POST">
                {% include 'includes/question_slider.html' %}
            </form>
        </div>
    </div>

    {% include 'includes/success_modal.html' %}

    <script src="{{ url_for('static', filename='js/common_validation.js') }}"></script>
    <script>
        // Override navigation functions for this template
        function getNextRouteFromNavInfo() {
            {% if nav_info and nav_info.next_route %}
                return '{{ nav_info.next_route }}';
            {% endif %}
            return null;
        }

        function getPreviousRouteFromNavInfo() {
            {% if nav_info and nav_info.previous_route %}
                return '{{ nav_info.previous_route }}';
            {% endif %}
            return null;
        }

        // Override submitAllQuestions function to use harmonized submit for contraintes
        const originalSubmitAllQuestions = window.submitAllQuestions;
        window.submitAllQuestions = function() {
            // Check if all questions are completed
            const questionData = {{ questions|tojson }};
            const incompleteQuestions = [];
            
            questionData.forEach((question, index) => {
                if (!isQuestionCompleted(question.field_name)) {
                    incompleteQuestions.push(index + 1);
                }
            });
            
            if (incompleteQuestions.length > 0) {
                alert(`Veuillez compléter les questions suivantes : ${incompleteQuestions.join(', ')}`);
                goToQuestion(incompleteQuestions[0]);
                return;
            }
            
            // Custom data processor for contraintes form
            function processContraintesData() {
                const form = document.getElementById('questionnaireForm');
                if (!form) return {};
                
                const data = {};
                
                // Handle radio buttons
                const radioButtons = form.querySelectorAll('input[type="radio"]:checked');
                radioButtons.forEach(radio => {
                    data[radio.name] = radio.value;
                });
                
                // Handle text inputs for specific options
                const textInputs = form.querySelectorAll('input[type="text"]');
                textInputs.forEach(textInput => {
                    if (textInput.value.trim() !== '') {
                        const fieldName = textInput.name.replace('_text', '');
                        // Combine the radio selection with the text input
                        if (data[fieldName]) {
                            data[fieldName] = data[fieldName] + ' : ' + textInput.value.trim();
                        }
                    }
                });
                
                return data;
            }
            
            // Use harmonized submit
            const submitHandler = createHarmonizedSubmitButton({
                buttonId: 'submitBtn',
                buttonText: '✅ Valider et Continuer vers {{ get_page_name_by_step(nav_info.step + 1) }}',
                endpoint: '/submit_contraintes',
                dataProcessor: processContraintesData,
                loadingText: '⏳ Sauvegarde en cours...'
            });
            
            // Create a temporary form submission event
            const event = new Event('submit', { bubbles: true, cancelable: true });
            document.getElementById('questionnaireForm').dispatchEvent(event);
        };
    </script>
</body>
</html> 